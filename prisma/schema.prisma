generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      BigInt                   @id @default(autoincrement())
  username                String                   @unique @db.VarChar(100)
  email                   String                   @unique @db.VarChar(100)
  passwordHash            String                   @map("password_hash") @db.VarChar(255)
  active                  Boolean                  @default(true)
  emailVerified           Boolean                  @default(false) @map("email_verified")
  createdAt               DateTime                 @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime                 @updatedAt @map("updated_at") @db.Timestamptz(6)
  stripeCustomerId        String?                  @map("stripe_customer_id") @db.VarChar(255)
  stripeSubscriptionId    String?                  @map("stripe_subscription_id") @db.VarChar(255)
  subscriptionEndsAt      DateTime?                @map("subscription_ends_at") @db.Timestamptz(6)
  subscriptionStartsAt    DateTime?                @map("subscription_starts_at") @db.Timestamptz(6)
  subscriptionStatus      SubscriptionStatus       @default(active) @map("subscription_status")
  subscriptionTier        SubscriptionTier         @default(premium) @map("subscription_tier")
  trialEndsAt             DateTime?                @map("trial_ends_at") @db.Timestamptz(6)
  dataExports             DataExport[]
  friendRequestsReceived  FriendRequest[]          @relation("RecipientRelation")
  friendRequestsSent      FriendRequest[]          @relation("RequesterRelation")
  friendsReceived         Friend[]                 @relation("FriendOfUser")
  friendsInitiated        Friend[]                 @relation("UserFriends")
  lifetimeGrants          LifetimeGrant[]
  RoundInsights           RoundInsight[]
  roundStrokesGaineds     RoundStrokesGained[]
  rounds                  Round[]
  subscriptionEvents      SubscriptionEvent[]
  userAchievementEvents   UserAchievementEvent[]
  userAchievementProgress UserAchievementProgress?
  userAchievements        UserAchievement[]
  leaderboardStats        UserLeaderboardStats?
  profile                 UserProfile?

  @@index([subscriptionTier, subscriptionStatus], map: "idx_users_subscription")
  @@index([stripeCustomerId], map: "idx_users_stripe_customer")
  @@map("users")
}

model UserProfile {
  id                  BigInt              @id @default(autoincrement())
  userId              BigInt              @unique @map("user_id")
  firstName           String?             @map("first_name") @db.VarChar(100)
  lastName            String?             @map("last_name") @db.VarChar(100)
  avatarUrl           String              @default("/avatars/default.png") @map("avatar_url") @db.VarChar(255)
  bio                 String?
  gender              Gender              @default(unspecified)
  defaultTee          DefaultTee          @default(white) @map("default_tee")
  favoriteCourseId    BigInt?             @map("favorite_course_id")
  dashboardVisibility DashboardVisibility @default(friends) @map("dashboard_visibility")
  createdAt           DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime            @updatedAt @map("updated_at") @db.Timestamptz(6)
  theme               String              @default("dark") @db.VarChar(50)
  timezone            String?             @db.VarChar(100)
  showStrokesGained   Boolean             @default(false) @map("show_strokes_gained")
  favoriteCourse      Course?             @relation(fields: [favoriteCourseId], references: [id])
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([dashboardVisibility], map: "idx_dashboard_visibility")
  @@map("user_profiles")
}

model UserLeaderboardStats {
  id           BigInt   @id @default(autoincrement())
  userId       BigInt   @unique @map("user_id")
  handicap     Decimal? @db.Decimal(4, 1)
  averageScore Decimal? @map("average_score") @db.Decimal(5, 1)
  bestScore    Int?     @map("best_score") @db.SmallInt
  totalRounds  Int      @default(0) @map("total_rounds")
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  averageToPar Decimal? @map("average_to_par") @db.Decimal(5, 1)
  bestToPar    Decimal? @map("best_to_par") @db.Decimal(5, 1)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([handicap], map: "idx_handicap")
  @@index([averageScore], map: "idx_average_score")
  @@index([averageToPar], map: "idx_average_to_par")
  @@index([totalRounds], map: "idx_total_rounds")
  @@map("user_leaderboard_stats")
}

model PasswordResetToken {
  id        BigInt    @id @default(autoincrement())
  email     String    @db.VarChar(100)
  token     String    @unique @db.VarChar(255)
  expiresAt DateTime  @map("expires_at") @db.Timestamptz(6)
  usedAt    DateTime? @map("used_at") @db.Timestamptz(6)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([email], map: "idx_password_reset_email")
  @@index([token], map: "idx_password_reset_token")
  @@index([expiresAt], map: "idx_password_reset_expires")
  @@map("password_reset_tokens")
}

model EmailVerificationToken {
  id        BigInt    @id @default(autoincrement())
  email     String    @db.VarChar(100)
  token     String    @unique @db.VarChar(255)
  expiresAt DateTime  @map("expires_at") @db.Timestamptz(6)
  usedAt    DateTime? @map("used_at") @db.Timestamptz(6)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([email], map: "idx_email_verification_email")
  @@index([token], map: "idx_email_verification_token")
  @@index([expiresAt], map: "idx_email_verification_expires")
  @@map("email_verification_tokens")
}

model Course {
  id                 BigInt        @id @default(autoincrement())
  clubName           String        @map("club_name") @db.VarChar(255)
  courseName         String        @map("course_name") @db.VarChar(255)
  createdAt          DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)
  verified           Boolean       @default(false)
  location           Location?
  rounds             Round[]
  tees               Tee[]
  favoriteByProfiles UserProfile[]

  @@index([verified], map: "idx_course_verified")
  @@map("courses")
}

model Location {
  id        BigInt   @id @default(autoincrement())
  courseId  BigInt   @unique @map("course_id")
  address   String?  @db.VarChar(255)
  city      String?  @db.VarChar(100)
  state     String?  @db.VarChar(50)
  country   String?  @db.VarChar(50)
  latitude  Decimal? @db.Decimal(10, 7)
  longitude Decimal? @db.Decimal(10, 7)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId], map: "idx_location_course_id")
  @@map("locations")
}

model Tee {
  id                BigInt    @id @default(autoincrement())
  courseId          BigInt    @map("course_id")
  gender            TeeGender
  teeName           String    @map("tee_name") @db.VarChar(100)
  courseRating      Decimal?  @map("course_rating") @db.Decimal(5, 2)
  slopeRating       Int?      @map("slope_rating")
  bogeyRating       Decimal?  @map("bogey_rating") @db.Decimal(5, 2)
  totalYards        Int?      @map("total_yards")
  totalMeters       Int?      @map("total_meters")
  numberOfHoles     Int?      @map("number_of_holes")
  parTotal          Int?      @map("par_total")
  frontCourseRating Decimal?  @map("front_course_rating") @db.Decimal(5, 2)
  frontSlopeRating  Int?      @map("front_slope_rating")
  frontBogeyRating  Decimal?  @map("front_bogey_rating") @db.Decimal(5, 2)
  backCourseRating  Decimal?  @map("back_course_rating") @db.Decimal(5, 2)
  backSlopeRating   Int?      @map("back_slope_rating")
  backBogeyRating   Decimal?  @map("back_bogey_rating") @db.Decimal(5, 2)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  nonPar3Holes      Int       @map("non_par3_holes")
  holes             Hole[]
  rounds            Round[]
  course            Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId], map: "idx_tee_course_id")
  @@map("tees")
}

model Hole {
  id         BigInt      @id @default(autoincrement())
  teeId      BigInt      @map("tee_id")
  holeNumber Int         @map("hole_number")
  par        Int
  yardage    Int
  handicap   Int?
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  tee        Tee         @relation(fields: [teeId], references: [id], onDelete: Cascade)
  roundHoles RoundHole[]

  @@index([teeId], map: "idx_hole_tee_id")
  @@map("holes")
}

model Round {
  id                    BigInt                 @id @default(autoincrement())
  userId                BigInt                 @map("user_id")
  courseId              BigInt                 @map("course_id")
  teeId                 BigInt                 @map("tee_id")
  holeByHole            Boolean                @default(false) @map("hole_by_hole")
  advancedStats         Boolean                @default(false) @map("advanced_stats")
  date                  DateTime               @db.Timestamptz(6)
  score                 Int
  netScore              Int?                   @map("net_score")
  firHit                Int?                   @map("fir_hit")
  girHit                Int?                   @map("gir_hit")
  putts                 Int?
  penalties             Int?
  notes                 String?
  createdAt             DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime               @updatedAt @map("updated_at") @db.Timestamptz(6)
  toPar                 Int?                   @map("to_par") @db.SmallInt
  netToPar              Int?                   @map("net_to_par") @db.SmallInt
  handicapAtRound       Decimal?               @map("handicap_at_round") @db.Decimal(4, 1)
  teeSegment            String                 @default("full") @map("tee_segment")
  holesPlayed           Int                    @default(18) @map("holes_played")
  roundHoles            RoundHole[]
  RoundInsight          RoundInsight?
  roundStrokesGained    RoundStrokesGained?
  course                Course                 @relation(fields: [courseId], references: [id], onDelete: Cascade)
  tee                   Tee                    @relation(fields: [teeId], references: [id])
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userAchievementEvents UserAchievementEvent[]

  @@index([userId], map: "idx_user_id")
  @@index([courseId], map: "idx_round_course_id")
  @@index([teeId], map: "idx_round_tee_id")
  @@map("rounds")
}

model RoundHole {
  id        BigInt   @id @default(autoincrement())
  roundId   BigInt   @map("round_id")
  holeId    BigInt   @map("hole_id")
  pass      Int      @default(1) @map("pass") @db.SmallInt
  score     Int
  firHit    Int?     @map("fir_hit")
  girHit    Int?     @map("gir_hit")
  putts     Int?
  penalties Int?
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  hole      Hole     @relation(fields: [holeId], references: [id], onDelete: Cascade)
  round     Round    @relation(fields: [roundId], references: [id], onDelete: Cascade)

  @@unique([roundId, holeId, pass], name: "unique_round_hole_pass")
  @@index([roundId], map: "idx_round_id")
  @@index([holeId], map: "idx_hole_id")
  @@map("round_holes")
}

model FriendRequest {
  id          BigInt   @id @default(autoincrement())
  requesterId BigInt   @map("requester_id")
  recipientId BigInt   @map("recipient_id")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  recipient   User     @relation("RecipientRelation", fields: [recipientId], references: [id], onDelete: Cascade)
  requester   User     @relation("RequesterRelation", fields: [requesterId], references: [id], onDelete: Cascade)

  @@unique([requesterId, recipientId], name: "uq_friend_requests_unique")
  @@index([requesterId], map: "idx_friend_requests_requester")
  @@index([recipientId], map: "idx_friend_requests_recipient")
  @@map("friend_requests")
}

model Friend {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt   @map("user_id")
  friendId  BigInt   @map("friend_id")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  friend    User     @relation("FriendOfUser", fields: [friendId], references: [id], onDelete: Cascade)
  user      User     @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId], name: "uq_friends_unique")
  @@index([userId], map: "idx_friends_user")
  @@index([friendId], map: "fk_friends_friend")
  @@map("friends")
}

model SubscriptionEvent {
  id            BigInt   @id @default(autoincrement())
  userId        BigInt   @map("user_id")
  eventType     String   @map("event_type") @db.VarChar(50)
  oldTier       String?  @map("old_tier") @db.VarChar(20)
  newTier       String?  @map("new_tier") @db.VarChar(20)
  oldStatus     String?  @map("old_status") @db.VarChar(20)
  newStatus     String?  @map("new_status") @db.VarChar(20)
  stripeEventId String?  @map("stripe_event_id") @db.VarChar(255)
  metadata      Json?
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_subscription_events_user")
  @@index([eventType], map: "idx_subscription_events_type")
  @@index([createdAt], map: "idx_subscription_events_date")
  @@map("subscription_events")
}

model LifetimeGrant {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt   @map("user_id")
  grantedBy String   @map("granted_by") @db.VarChar(255)
  reason    String
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_lifetime_grants_user")
  @@map("lifetime_grants")
}

model DataExport {
  id          BigInt   @id @default(autoincrement())
  userId      BigInt   @map("user_id")
  format      String   @db.VarChar(10)
  recordCount Int      @map("record_count")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_data_exports_user")
  @@index([createdAt], map: "idx_data_exports_date")
  @@map("data_exports")
}

model ApiUsageLog {
  id        BigInt   @id @default(autoincrement())
  endpoint  String   @db.VarChar(100)
  userId    BigInt?  @map("user_id")
  ipAddress String?  @map("ip_address") @db.VarChar(45)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([endpoint, createdAt], map: "idx_api_usage_endpoint_date")
  @@index([userId, createdAt], map: "idx_api_usage_user_date")
  @@map("api_usage_logs")
}

model AllowedEmail {
  id        BigInt   @id @default(autoincrement())
  email     String   @unique @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  addedBy   String?  @map("added_by") @db.VarChar(255)
  notes     String?

  @@index([email], map: "idx_allowed_emails_email")
  @@map("allowed_emails")
}

model FeatureFlag {
  flagName    String   @id @map("flag_name") @db.VarChar(100)
  enabled     Boolean  @default(false)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  description String?

  @@map("feature_flags")
}

model Waitlist {
  id                BigInt   @id @default(autoincrement())
  email             String   @unique @db.VarChar(255)
  name              String?  @db.VarChar(255)
  handicap          String?  @db.VarChar(50)
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  source            String   @default("landing_page") @db.VarChar(50)
  confirmed         Boolean  @default(false)
  confirmationToken String?  @unique @map("confirmation_token") @db.VarChar(255)
  metadata          Json?

  @@index([confirmed], map: "idx_waitlist_confirmed")
  @@index([email], map: "idx_waitlist_email")
  @@map("waitlist")
}

model RoundStrokesGained {
  id              BigInt      @id @default(autoincrement())
  roundId         BigInt      @unique @map("round_id")
  userId          BigInt      @map("user_id")
  sgTotal         Decimal?    @map("sg_total") @db.Decimal(5, 2)
  sgOffTee        Decimal?    @map("sg_off_tee") @db.Decimal(5, 2)
  sgApproach      Decimal?    @map("sg_approach") @db.Decimal(5, 2)
  sgResidual      Decimal?    @map("sg_residual") @db.Decimal(5, 2)
  sgPutting       Decimal?    @map("sg_putting") @db.Decimal(5, 2)
  sgPenalties     Decimal?    @map("sg_penalties") @db.Decimal(5, 2)
  confidence      Confidence? @map("confidence")
  createdAt       DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  messages        Json?
  partialAnalysis Boolean?    @map("partial_analysis")
  round           Round       @relation(fields: [roundId], references: [id], onDelete: Cascade)
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([roundId], map: "idx_round_strokes_gained_round")
  @@index([userId], map: "idx_round_strokes_gained_user")
  @@map("round_strokes_gained")
}

model HandicapTierBaseline {
  id                BigInt   @id @default(autoincrement())
  handicap          Int      @map("handicap")
  baselineScore     Decimal  @map("baseline_score") @db.Decimal(5, 1)
  baselineGIRPct    Decimal  @map("baseline_gir_pct") @db.Decimal(5, 1)
  baselineFIRPct    Decimal  @map("baseline_fir_pct") @db.Decimal(5, 1)
  baselinePutts     Decimal  @map("baseline_putts") @db.Decimal(5, 1)
  baselinePenalties Decimal  @map("baseline_penalties") @db.Decimal(5, 1)
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@map("handicap_tier_baseline")
}

model RoundInsight {
  id        BigInt    @id @default(autoincrement())
  roundId   BigInt    @unique @map("round_id")
  userId    BigInt    @map("user_id")
  modelUsed String    @default("gpt-5-mini") @map("model_used")
  insights  Json
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @map("updated_at") @db.Timestamptz(6)
  round     Round     @relation(fields: [roundId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([roundId], map: "idx_round_insights_round")
  @@index([userId], map: "idx_round_insights_user")
  @@map("round_insights")
}

model AchievementTier {
  id            BigInt      @id @default(autoincrement())
  achievementId BigInt      @map("achievement_id")
  tierId        BigInt      @map("tier_id")
  threshold     Int         @db.SmallInt
  createdAt     DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tier          TierLevel   @relation(fields: [tierId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([achievementId, tierId], map: "achievement_tiers_unique_achievement_tier")
  @@map("achievement_tiers")
}

model Achievement {
  id                    BigInt                 @id @default(autoincrement())
  name                  String                 @db.VarChar
  description           String?                @db.VarChar
  createdAt             DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  achievementTiers      AchievementTier[]
  userAchievementEvents UserAchievementEvent[]
  userAchievements      UserAchievement[]

  @@map("achievements")
}

model TierLevel {
  id                    BigInt                 @id @default(autoincrement())
  name                  Tier
  createdAt             DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  achievementTiers      AchievementTier[]
  userAchievementEvents UserAchievementEvent[]
  userAchievements      UserAchievement[]

  @@map("tiers")
}

model UserAchievementEvent {
  id            BigInt      @id @default(autoincrement())
  userId        BigInt      @map("user_id")
  achievementId BigInt      @map("achievement_id")
  tierId        BigInt      @map("tier_id")
  roundId       BigInt      @map("round_id")
  createdAt     DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  round         Round       @relation(fields: [roundId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tier          TierLevel   @relation(fields: [tierId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([roundId], map: "idx_user_achievement_events_round")
  @@index([userId, achievementId], map: "idx_user_achievement_events_user_achievement")
  @@map("user_achievement_events")
}

model UserAchievementProgress {
  id                    BigInt   @id @default(autoincrement())
  userId                BigInt   @unique @map("user_id")
  holeInOneCount        Int?     @map("hole_in_one_count") @db.SmallInt
  albatrossCount        Int?     @map("albatross_count") @db.SmallInt
  eagleCount            Int?     @map("eagle_count") @db.SmallInt
  perfectRoundCount     Int?     @map("perfect_round_count") @db.SmallInt
  penaltyFreeRoundCount Int?     @map("penalty_free_round_count") @db.SmallInt
  puttMasterCount       Int?     @map("putt_master_count") @db.SmallInt
  roundsPlayedCount     Int?     @map("rounds_played_count") @db.SmallInt
  coursesPlayedCount    Int?     @map("courses_played_count") @db.SmallInt
  bestScore             Int?     @map("best_score") @db.SmallInt
  underParCount         Int?     @map("under_par_count") @db.SmallInt
  updatedAt             DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_achievement_progress")
}

model UserAchievement {
  id            BigInt      @id @default(autoincrement())
  userId        BigInt      @map("user_id")
  achievementId BigInt      @map("achievement_id")
  tierId        BigInt      @map("tier_id")
  unlockedAt    DateTime?   @map("unlocked_at") @db.Timestamptz(6)
  createdAt     DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime    @default(now()) @map("updated_at") @db.Timestamptz(6)
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tier          TierLevel   @relation(fields: [tierId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, achievementId], map: "user_achievements_unique_user_achievement")
  @@map("user_achievements")
}

enum SubscriptionTier {
  free
  premium
  lifetime
}

enum SubscriptionStatus {
  active
  cancelled
  past_due
}

enum Gender {
  male
  female
  unspecified
}

enum DefaultTee {
  blue
  white
  red
  gold
  black
}

enum DashboardVisibility {
  private
  friends
  public
}

enum TeeGender {
  male
  female
}

enum Confidence {
  low
  medium
  high
}

enum Tier {
  bronze
  silver
  gold
  platinum
  diamond
}
